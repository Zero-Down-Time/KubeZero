diff '--color=auto' -rtuN charts/redis-replication.orig/templates/_helpers.tpl charts/redis-replication/templates/_helpers.tpl
--- charts/redis-replication.orig/templates/_helpers.tpl	2026-02-14 17:48:58.962057834 +0000
+++ charts/redis-replication/templates/_helpers.tpl	2026-02-14 17:54:13.634258859 +0000
@@ -40,4 +40,24 @@
 {{- end }}
 {{- end }}
 {{- end }}
-{{- end -}}
\ No newline at end of file
+{{- end -}}
+
+{{/* Generate sidecar properties for redis-vault */}}
+{{- define "redisVault.sidecar" -}}
+- name: redis-vault
+  image: {{ .Values.redisVault.image.repository }}:{{ .Values.redisVault.image.tag }}
+  resources: {{ toYaml .Values.redisVault.resources | nindent 4 }}
+  mountPath:
+    - name: {{ .Values.redisReplication.name | default .Release.Name }}
+      mountPath: /data
+      readOnly: true
+  securityContext:
+    runAsUser: 1000
+    runAsNonRoot: true
+    readOnlyRootFilesystem: true
+    capabilities:
+      drop: ["ALL"]
+  {{- with .Values.redisVault.env }}
+  env: {{ toYaml . | nindent 4 }}
+  {{- end -}}
+{{- end -}}
diff '--color=auto' -rtuN charts/redis-replication.orig/templates/redis-replication.yaml charts/redis-replication/templates/redis-replication.yaml
--- charts/redis-replication.orig/templates/redis-replication.yaml	2026-02-14 17:48:58.965391191 +0000
+++ charts/redis-replication/templates/redis-replication.yaml	2026-02-14 17:59:55.966653363 +0000
@@ -9,7 +9,7 @@
     redis.opstreelabs.in/recreate-statefulset: "true"
     {{ end }}
 spec:
-  clusterSize: {{ .Values.redisReplication.clusterSize }}  
+  clusterSize: {{ .Values.redisReplication.clusterSize }}
   kubernetesConfig:
     image: "{{ .Values.redisReplication.image }}:{{ .Values.redisReplication.tag }}"
     imagePullPolicy: "{{ .Values.redisReplication.imagePullPolicy }}"
@@ -33,6 +33,10 @@
     {{- if .Values.redisReplication.persistentVolumeClaimRetentionPolicy }}
     persistentVolumeClaimRetentionPolicy: {{ toYaml .Values.redisReplication.persistentVolumeClaimRetentionPolicy | nindent 6 }}
     {{- end }}
+    {{- with .Values.redisReplication.service }}
+    service:
+      {{- . | toYaml | nindent 6 }}
+    {{- end }}
   {{- if .Values.redisReplication.livenessProbe }}
   livenessProbe: {{ toYaml .Values.redisReplication.livenessProbe | nindent 4 }}
   {{- end }}
@@ -80,6 +84,21 @@
   {{- end }}
   {{- if .Values.affinity }}
   affinity: {{ toYaml .Values.affinity | nindent 4 }}
+  {{- else }}
+  affinity:
+    podAntiAffinity:
+      requiredDuringSchedulingIgnoredDuringExecution:
+        - labelSelector:
+            matchExpressions:
+              - key: app
+                operator: In
+                values:
+                  - {{ .Values.redisReplication.name | default .Release.Name }}
+              - key: role
+                operator: In
+                values:
+                  - replication
+          topologyKey: "kubernetes.io/hostname"
   {{- end }}
   {{- if .Values.tolerations }}
   tolerations: {{ toYaml .Values.tolerations | nindent 4 }}
@@ -108,9 +127,13 @@
   {{- if and .Values.initContainer .Values.initContainer.enabled (ne .Values.initContainer.image "") }}
   initContainer: {{ include "initContainer.properties" . | nindent 4 }}
   {{- end }}
+  {{- if .Values.redisVault.enabled }}
+  sidecars: {{ include "redisVault.sidecar" . | nindent 4 }}
+  {{- else }}
   {{- if .Values.sidecars }}
   sidecars: {{ toYaml .Values.sidecars | nindent 4 }}
   {{- end }}
+  {{- end }}
   {{- if and .Values.serviceAccountName (ne .Values.serviceAccountName "") }}
   serviceAccountName: "{{ .Values.serviceAccountName }}"
   {{- end }}
@@ -120,7 +143,8 @@
   {{- if .Values.pdb.enabled }}
   pdb:
     enabled: {{ .Values.pdb.enabled }}
-    minAvailable: {{ .Values.pdb.minAvailable }}
+    {{- with .Values.pdb.minAvailable }}
+    minAvailable: {{ . }}
+    {{- end }}
     maxUnavailable: {{ .Values.pdb.maxUnavailable }}
   {{- end }}
-  
diff '--color=auto' -rtuN charts/redis-replication.orig/values.yaml charts/redis-replication/values.yaml
--- charts/redis-replication.orig/values.yaml	2026-02-14 17:48:58.962057834 +0000
+++ charts/redis-replication/values.yaml	2026-02-14 17:48:58.965391191 +0000
@@ -196,5 +196,4 @@
 
 pdb:
   enabled: false
-  minAvailable: 1
-  maxUnavailable: null
+  maxUnavailable: 1
